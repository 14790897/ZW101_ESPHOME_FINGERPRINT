# æŒ‡çº¹IDåˆ†é…é—®é¢˜ä¿®å¤

## ğŸ› é—®é¢˜æè¿°

### é—®é¢˜1: åªèƒ½å½•å…¥ä¸€ä¸ªæŒ‡çº¹
**ç—‡çŠ¶**: ç¬¬äºŒæ¬¡æ³¨å†Œä¼šè¦†ç›–ç¬¬ä¸€ä¸ªæŒ‡çº¹

**åŸå› **: åŸå§‹ ZW101.ino ä½¿ç”¨å›ºå®š ID (TEMPLATE_ID = 0),æ¯æ¬¡éƒ½å­˜åˆ°ID 0

### é—®é¢˜2: æ˜¾ç¤ºçš„IDä¸æ­£ç¡® âš ï¸ **æ–°å‘ç°**
**ç—‡çŠ¶**: å½•å…¥ID 1å’Œ2,ä½†åŒ¹é…æ—¶æ˜¾ç¤ºID 10

**åŸå› **:
1. æœç´¢èŒƒå›´é”™è¯¯: `send_search_cmd(1, 1, 1)` åªæœç´¢Page 1ä¸€ä¸ªä½ç½®
2. **IDèµ·å§‹é”™è¯¯**: ZW101çš„PageIDæ˜¯ä» **0** å¼€å§‹ (0-199),ä¸æ˜¯ä»1å¼€å§‹!

## âœ… ä¿®å¤æ–¹æ¡ˆ

### 1. æ­£ç¡®çš„IDèŒƒå›´

**ZW101 PageIDèŒƒå›´**: **0 ~ 199** (å…±200ä¸ª)

| PageID | è¯´æ˜ |
|--------|------|
| 0 | ç¬¬1ä¸ªæŒ‡çº¹ |
| 1 | ç¬¬2ä¸ªæŒ‡çº¹ |
| 2 | ç¬¬3ä¸ªæŒ‡çº¹ |
| ... | ... |
| 199 | ç¬¬200ä¸ªæŒ‡çº¹ |

### 2. ä¿®å¤æœç´¢èŒƒå›´ (zw101.cpp:116)

**ä¿®æ”¹å‰**:
```cpp
send_search_cmd(1, 1, 1);  // âŒ åªæœç´¢Page 1ä¸€ä¸ªä½ç½®
```

**ä¿®æ”¹å**:
```cpp
send_search_cmd(1, 0, library_capacity_);  // âœ… ä»Page 0æœç´¢æ•´ä¸ªåº“
```

### 3. ä¿®å¤IDèµ·å§‹å€¼

**zw101.h:91**:
```cpp
uint16_t next_fingerprint_id_{0};  // âœ… ä»0å¼€å§‹,ä¸æ˜¯1
```

**zw101.cpp:320**:
```cpp
next_fingerprint_id_ = register_cnt;  // âœ… ä¸‹ä¸€ä¸ªID = å·²æ³¨å†Œæ•°é‡
// ä¾‹å¦‚: 0ä¸ªæŒ‡çº¹ â†’ next_id=0
//      2ä¸ªæŒ‡çº¹ â†’ next_id=2 (å› ä¸º0å’Œ1å·²å ç”¨)
```

**zw101.cpp:232**:
```cpp
if (next_fingerprint_id_ >= library_capacity_) {
  next_fingerprint_id_ = 0;  // âœ… å¾ªç¯ä»0å¼€å§‹
}
```

**zw101.cpp:280**:
```cpp
next_fingerprint_id_ = 0;  // âœ… æ¸…ç©ºåä»0å¼€å§‹
```

## ğŸ“Š å·¥ä½œåŸç†

### å¯åŠ¨æ—¶:
1. `CMD_READ_VALID_NUMS` è¿”å›å·²æ³¨å†Œæ•°é‡ = 2
2. `next_fingerprint_id_` = 2 (å› ä¸ºPage 0å’Œ1å·²å ç”¨)

### æ³¨å†ŒæŒ‡çº¹æ—¶:
| æ“ä½œ | PageID | next_fingerprint_id_ | è¯´æ˜ |
|------|--------|----------------------|------|
| å¯åŠ¨(0ä¸ªæŒ‡çº¹) | - | 0 | ç¬¬1ä¸ªå°†å­˜åˆ°Page 0 |
| æ³¨å†Œç¬¬1ä¸ª | 0 | 1 | ç¬¬2ä¸ªå°†å­˜åˆ°Page 1 |
| æ³¨å†Œç¬¬2ä¸ª | 1 | 2 | ç¬¬3ä¸ªå°†å­˜åˆ°Page 2 |
| æ³¨å†Œç¬¬3ä¸ª | 2 | 3 | ç¬¬4ä¸ªå°†å­˜åˆ°Page 3 |
| ... | ... | ... | ... |
| æ³¨å†Œç¬¬200ä¸ª | 199 | 0 (å¾ªç¯) | ä¸‹æ¬¡è¦†ç›–Page 0 |

### æœç´¢æŒ‡çº¹æ—¶:
```cpp
send_search_cmd(1, 0, 200);
// buffer_id = 1
// start_page = 0   âœ… ä»Page 0å¼€å§‹
// page_num = 200   âœ… æœç´¢200ä¸ªPage (0-199)
```

è¿”å›çš„Pageå·ç›´æ¥æ˜¾ç¤ºä¸ºID:
- Page 0 â†’ æ˜¾ç¤ºID 0
- Page 1 â†’ æ˜¾ç¤ºID 1
- Page 9 â†’ æ˜¾ç¤ºID 9 (ä¹‹å‰é”™è¯¯æ˜¾ç¤ºä¸º10)

## ğŸ¯ æµ‹è¯•éªŒè¯

### æµ‹è¯•æ­¥éª¤:
1. æ¸…ç©ºæŒ‡çº¹åº“: æ‰“å¼€ "Clear Library" å¼€å…³
2. æ³¨å†Œç¬¬1ä¸ªæŒ‡çº¹ â†’ åº”è¯¥å­˜åˆ° **Page 0** (æ˜¾ç¤ºID 0)
3. æ³¨å†Œç¬¬2ä¸ªæŒ‡çº¹ â†’ åº”è¯¥å­˜åˆ° **Page 1** (æ˜¾ç¤ºID 1)
4. æ³¨å†Œç¬¬3ä¸ªæŒ‡çº¹ â†’ åº”è¯¥å­˜åˆ° **Page 2** (æ˜¾ç¤ºID 2)
5. æµ‹è¯•åŒ¹é…æ‰€æœ‰3ä¸ªæŒ‡çº¹,éªŒè¯IDæ­£ç¡®

### æŸ¥çœ‹æ—¥å¿—:
```
[I][zw101:221] Fingerprint enrolled successfully as ID 0
[I][zw101:234] Next fingerprint will use ID: 1

[I][zw101:221] Fingerprint enrolled successfully as ID 1
[I][zw101:234] Next fingerprint will use ID: 2

[I][zw101:221] Fingerprint enrolled successfully as ID 2
[I][zw101:234] Next fingerprint will use ID: 3

[I][zw101:126] Match found! Page: 0, Score: 95
[I][zw101:126] Match found! Page: 1, Score: 98
[I][zw101:126] Match found! Page: 2, Score: 92
```

## ğŸš€ ä½¿ç”¨å»ºè®®

### 1. æ¸…ç©ºåé‡æ–°å¼€å§‹
```yaml
# å…ˆæ¸…ç©ºæŒ‡çº¹åº“
service: switch.turn_on
target:
  entity_id: switch.zw101_fingerprint_clear_library

# ç­‰å¾…å‡ ç§’åå¼€å§‹æ³¨å†Œ
# ç¬¬ä¸€ä¸ªæŒ‡çº¹å°†ä½¿ç”¨ ID 1
```

### 2. æŸ¥çœ‹å½“å‰æ•°é‡
```yaml
service: esphome.fingerprint_zw101_read_count
# æ—¥å¿—ä¼šæ˜¾ç¤º: "Valid template count: X"
```

### 3. åˆ é™¤ç‰¹å®šæŒ‡çº¹
```yaml
service: esphome.fingerprint_zw101_delete_fingerprint
data:
  fingerprint_id: 1  # åˆ é™¤Page 1 (ç¬¬2ä¸ªæŒ‡çº¹)
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **IDä»0å¼€å§‹**: ZW101æ¨¡ç»„çš„PageIDèŒƒå›´æ˜¯ **0~199** (å…±200ä¸ª)
2. **å¾ªç¯è¦†ç›–**: è¶…è¿‡200ä¸ªåä¼šä»Page 0é‡æ–°å¼€å§‹,è¦†ç›–æ—§æŒ‡çº¹
3. **åˆ é™¤åç©ºæ´**: åˆ é™¤Page 5å,ä¸‹æ¬¡æ³¨å†Œä»ä¼šç”¨æœ€å¤§ID,ä¸ä¼šå¡«è¡¥ç©ºæ´
4. **é‡å¯ä¿æŒ**: `next_fingerprint_id_` åœ¨é‡å¯åé€šè¿‡ `read_fp_info()` æ¢å¤

## ğŸ‰ ç»“è®º

ä¿®å¤å:
- âœ… **æœç´¢èŒƒå›´æ­£ç¡®**: ä»Page 0æœç´¢æ•´ä¸ªåº“(0-199)
- âœ… **IDèµ·å§‹æ­£ç¡®**: ä»Page 0å¼€å§‹åˆ†é…
- âœ… **IDæ˜¾ç¤ºæ­£ç¡®**: è¿”å›çš„Pageå·ç›´æ¥å¯¹åº”ID
- âœ… **å¤šæŒ‡çº¹æ”¯æŒ**: å¯ä»¥æ­£ç¡®æ³¨å†Œå’Œè¯†åˆ«å¤šä¸ªæŒ‡çº¹

---

**ä¿®å¤ç‰ˆæœ¬**: 1.0.2
**ä¿®å¤æ—¥æœŸ**: 2025-10-20
**ç›¸å…³æ–‡ä»¶**:
- `zw101.h:91` - åˆå§‹IDæ”¹ä¸º0
- `zw101.cpp:116` - æœç´¢èŒƒå›´æ”¹ä¸º(1, 0, 200)
- `zw101.cpp:232` - å¾ªç¯æ”¹ä¸ºä»0å¼€å§‹
- `zw101.cpp:280` - æ¸…ç©ºåä»0å¼€å§‹
- `zw101.cpp:320` - ä¸‹ä¸€ä¸ªIDè®¡ç®—å…¬å¼
