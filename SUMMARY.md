# ZW101 æŒ‡çº¹è¯†åˆ«æ¨¡ç»„ ESPHome ç»„ä»¶ - å®Œæ•´æ€»ç»“

## ğŸ‰ é¡¹ç›®å®Œæˆ

åŸºäº `fp_syno_protocol.c` å’Œ ZW101.ino,æˆåŠŸåˆ›å»ºäº†åŠŸèƒ½å®Œæ•´çš„ ESPHome External Component!

## ğŸ“Š åŠŸèƒ½å¯¹æ¯”è¡¨

| åŠŸèƒ½ | ZW101.ino | fp_syno_protocol.c | ESPHome ç»„ä»¶ | çŠ¶æ€ |
|------|-----------|-------------------|--------------|------|
| **åŸºç¡€åŠŸèƒ½** |
| è·å–å›¾åƒ | âœ… | âœ… | âœ… | å®Œæˆ |
| ç”Ÿæˆç‰¹å¾ | âœ… | âœ… | âœ… | å®Œæˆ |
| æœç´¢æŒ‡çº¹ | âœ… | âœ… | âœ… éé˜»å¡ | **å¢å¼º** |
| åˆå¹¶ç‰¹å¾ | âœ… | âœ… | âœ… | å®Œæˆ |
| å­˜å‚¨æ¨¡æ¿ | âœ… | âœ… | âœ… | å®Œæˆ |
| æ¸…ç©ºæŒ‡çº¹åº“ | âœ… | âœ… | âœ… | å®Œæˆ |
| è¯»å–ç³»ç»Ÿå‚æ•° | âœ… | âŒ | âœ… | å®Œæˆ |
| **é«˜çº§åŠŸèƒ½** |
| åˆ é™¤æŒ‡å®šæŒ‡çº¹ | âŒ | âœ… | âœ… | **æ–°å¢** |
| è¯»å–æŒ‡çº¹æ•°é‡ | âŒ | âŒ | âœ… | **æ–°å¢** |
| RGB ç¯æ§åˆ¶ | âŒ | âœ… | âœ… | **æ–°å¢** |
| è¿›å…¥ä¼‘çœ  | âŒ | âœ… | âœ… | **æ–°å¢** |
| æ¡æ‰‹æµ‹è¯• | âŒ | âŒ | âœ… | **æ–°å¢** |
| è‡ªåŠ¨æ³¨å†Œæ¨¡å¼ | âŒ | âŒ | âœ… | **æ–°å¢** |
| è‡ªåŠ¨åŒ¹é…æ¨¡å¼ | âŒ | âŒ | âœ… | **æ–°å¢** |
| **æ¶æ„ç‰¹æ€§** |
| é˜»å¡å¼å®ç° | âœ… | âœ… | âŒ | - |
| éé˜»å¡çŠ¶æ€æœº | âŒ | âŒ | âœ… | **é‡è¦** |
| çœ‹é—¨ç‹—å®‰å…¨ | âŒ | âŒ | âœ… | **ä¿®å¤** |
| è¿ç»­æœç´¢åˆ¤æ–­ | âœ… | âœ… | âœ… | ä¿ç•™ |

## ğŸ—ï¸ æ¶æ„ä¼˜åŠ¿

### 1. External Component æ ‡å‡†
- âœ… ç¬¦åˆ ESPHome 2025.2.0+ æ ‡å‡†
- âœ… å®Œæ•´çš„ YAML é…ç½®éªŒè¯
- âœ… Python ä»£ç ç”Ÿæˆå±‚
- âœ… C++ è¿è¡Œæ—¶å±‚åˆ†ç¦»

### 2. éé˜»å¡è®¾è®¡
**ä¿®å¤å‰** (ä¼šå¯¼è‡´é‡å¯):
```cpp
while (retry <= 5) {
  send_cmd();
  delay(1000);  // âŒ é˜»å¡
}
```

**ä¿®å¤å** (å®Œå…¨éé˜»å¡):
```cpp
enum SearchState { IDLE, GET_IMAGE, GEN_CHAR, WAIT_RETRY, SEARCH };
void process_search() {
  switch (state) {
    case WAIT_RETRY:
      if (millis() - last_time > 500) state = GET_IMAGE;
      break;  // âœ… éé˜»å¡
  }
  yield();
}
```

### 3. çŠ¶æ€æœºç®¡ç†
- **æœç´¢çŠ¶æ€æœº**: 5çŠ¶æ€éé˜»å¡æœç´¢
- **æ³¨å†ŒçŠ¶æ€æœº**: 6çŠ¶æ€éé˜»å¡æ³¨å†Œ
- **è‡ªåŠ¨æ¨¡å¼**: æ”¯æŒè¶…æ—¶ç®¡ç†

## ğŸ“ æ–‡ä»¶ç»“æ„

```
components/zw101/
â”œâ”€â”€ __init__.py              # ä¸»ç»„ä»¶å®šä¹‰ (Python)
â”œâ”€â”€ binary_sensor.py         # Binary Sensor å¹³å°
â”œâ”€â”€ sensor.py                # Sensor å¹³å°
â”œâ”€â”€ text_sensor.py           # Text Sensor å¹³å°
â”œâ”€â”€ switch.py                # Switch å¹³å°
â”œâ”€â”€ zw101.h                  # C++ å¤´æ–‡ä»¶
â”œâ”€â”€ zw101.cpp                # C++ å®ç° (600+ è¡Œ)
â”œâ”€â”€ README.md                # åŸºç¡€è¯´æ˜
â”œâ”€â”€ BUGFIX.md                # é‡å¯é—®é¢˜ä¿®å¤è¯´æ˜
â”œâ”€â”€ QUICKFIX.md              # å¿«é€Ÿä¿®å¤å‚è€ƒ
â”œâ”€â”€ SWITCH_EXPLAINED.md      # switch.py è¯¦è§£
â”œâ”€â”€ FP_SYNO_ANALYSIS.md      # åè®®åˆ†æ
â”œâ”€â”€ FEATURES_ENHANCED.md     # å¢å¼ºåŠŸèƒ½è¯´æ˜
â”œâ”€â”€ EXAMPLES.md              # å®Œæ•´ä½¿ç”¨ç¤ºä¾‹
â””â”€â”€ SUMMARY.md               # æœ¬æ–‡æ¡£
```

## ğŸš€ æ ¸å¿ƒåŠŸèƒ½

### 1. åŸºç¡€æŒ‡çº¹æ“ä½œ
```cpp
bool register_fingerprint();           // æ³¨å†ŒæŒ‡çº¹ (5æ¬¡é‡‡é›†)
bool clear_fingerprint_library();      // æ¸…ç©ºæŒ‡çº¹åº“
void read_fp_info();                   // è¯»å–æ¨¡ç»„ä¿¡æ¯
```

### 2. é«˜çº§åŠŸèƒ½ (æ–°å¢)
```cpp
bool read_valid_template_count();      // è¯»å–æŒ‡çº¹æ•°é‡
bool handshake();                      // æ¡æ‰‹æµ‹è¯•
bool delete_fingerprint(uint16_t id);  // åˆ é™¤æŒ‡å®šæŒ‡çº¹
void set_rgb_led(mode, color, bright); // RGB ç¯æ§åˆ¶
```

### 3. è‡ªåŠ¨æ¨¡å¼ (æ–°å¢)
```cpp
bool enter_sleep_mode();               // è¿›å…¥ä¼‘çœ 
bool auto_enroll_mode(timeout_sec);    // è‡ªåŠ¨æ³¨å†Œ
bool auto_match_mode();                // è‡ªåŠ¨åŒ¹é…
void cancel_auto_mode();               // å–æ¶ˆè‡ªåŠ¨æ¨¡å¼
```

## ğŸ“ YAML é…ç½®ç¤ºä¾‹

```yaml
external_components:
  - source:
      type: local
      path: ../../components

uart:
  id: fingerprint_uart
  tx_pin: GPIO1
  rx_pin: GPIO0
  baud_rate: 57600

zw101:
  id: zw101_reader
  uart_id: fingerprint_uart

binary_sensor:
  - platform: zw101
    zw101_id: zw101_reader
    name: "Fingerprint Match"

sensor:
  - platform: zw101
    zw101_id: zw101_reader
    match_score:
      name: "Match Score"
    match_id:
      name: "Match ID"

text_sensor:
  - platform: zw101
    zw101_id: zw101_reader
    status:
      name: "Status"

switch:
  - platform: zw101
    zw101_id: zw101_reader
    enroll:
      name: "Enroll Fingerprint"
    clear:
      name: "Clear Library"

# æœåŠ¡æ¥å£
api:
  services:
    - service: delete_fingerprint
      variables:
        fingerprint_id: int
      then:
        - lambda: |-
            id(zw101_reader).delete_fingerprint(fingerprint_id);

    - service: set_led
      variables:
        mode: int
        color: int
        brightness: int
      then:
        - lambda: |-
            id(zw101_reader).set_rgb_led(mode, color, brightness);
```

## ğŸ”§ å…³é”®é—®é¢˜ä¿®å¤

### é—®é¢˜: è®¾å¤‡é¢‘ç¹é‡å¯
**åŸå› **: çœ‹é—¨ç‹—è¶…æ—¶ (å¤šå¤„ delay() é˜»å¡)

**ä¿®å¤**:
1. âœ… ç§»é™¤æ‰€æœ‰ `delay()` è°ƒç”¨
2. âœ… é‡æ„ä¸ºçŠ¶æ€æœº
3. âœ… æ·»åŠ  `yield()` è®©å‡º CPU
4. âœ… ä½¿ç”¨å®šæ—¶å™¨æ›¿ä»£å»¶è¿Ÿ

**æ•ˆæœ**:
- loop() æ‰§è¡Œæ—¶é—´: ~10ç§’ â†’ **<100ms**
- çœ‹é—¨ç‹—è¶…æ—¶: é¢‘ç¹ â†’ **æ°¸ä¸**
- WiFi ç¨³å®šæ€§: æ–­å¼€ â†’ **ç¨³å®š**

## ğŸ¨ LED ç¯æ•ˆæ§åˆ¶

æ”¯æŒ 7 ç§æ¨¡å¼å’Œ 7 ç§é¢œè‰²:

```cpp
// æ¨¡å¼
RGB_BREATH = 1     // å‘¼å¸ç¯
RGB_BLINK = 2      // é—ªçƒ
RGB_ON = 3         // å¸¸äº®
RGB_OFF = 4        // å…³é—­
RGB_FADE_IN = 5    // æ¸å˜å¼€
RGB_FADE_OUT = 6   // æ¸å˜å…³
RGB_MARQUEE = 7    // è·‘é©¬ç¯

// é¢œè‰²
COLOR_BLUE = 1     // è“è‰²
COLOR_GREEN = 2    // ç»¿è‰²
COLOR_RED = 4      // çº¢è‰²
COLOR_WHITE = 7    // ç™½è‰²
// ... æ›´å¤š
```

**ä½¿ç”¨ç¤ºä¾‹**:
```yaml
automation:
  # åŒ¹é…æˆåŠŸ - ç»¿è‰²å¸¸äº®
  - lambda: |-
      id(zw101_reader).set_rgb_led(3, 2, 200);

  # æ³¨å†Œä¸­ - è“è‰²å‘¼å¸
  - lambda: |-
      id(zw101_reader).set_rgb_led(1, 1, 100);

  # å¤±è´¥ - çº¢è‰²é—ªçƒ
  - lambda: |-
      id(zw101_reader).set_rgb_led(2, 4, 255);
```

## ğŸ“Š æ€§èƒ½æ•°æ®

| æŒ‡æ ‡ | ä¿®å¤å‰ | ä¿®å¤å |
|------|--------|--------|
| loop() æœ€å¤§æ‰§è¡Œæ—¶é—´ | ~10ç§’ | <100ms |
| çœ‹é—¨ç‹—è¶…æ—¶é¢‘ç‡ | ç»å¸¸ | ä»ä¸ |
| WiFi è¿æ¥ç¨³å®šæ€§ | ä¸ç¨³å®š | ç¨³å®š |
| å†…å­˜ä½¿ç”¨ | - | ä¼˜åŒ– |
| å“åº”å»¶è¿Ÿ | é«˜ | ä½ |

## ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§

1. **è¿ç»­5æ¬¡æœç´¢åˆ¤æ–­** - æé«˜è¯†åˆ«å‡†ç¡®ç‡
2. **éé˜»å¡è®¾è®¡** - ä¸å½±å“å…¶ä»–åŠŸèƒ½
3. **è¶…æ—¶ä¿æŠ¤** - è‡ªåŠ¨æ¨¡å¼è¶…æ—¶é€€å‡º
4. **é”™è¯¯å¤„ç†** - å®Œæ•´çš„é”™è¯¯ç å®šä¹‰
5. **çŠ¶æ€åé¦ˆ** - å®æ—¶çŠ¶æ€ä¼ æ„Ÿå™¨

## ğŸ“š æ–‡æ¡£ç³»ç»Ÿ

| æ–‡æ¡£ | å†…å®¹ | é€‚ç”¨å¯¹è±¡ |
|------|------|----------|
| README.md | åŸºç¡€è¯´æ˜ | æ‰€æœ‰ç”¨æˆ· |
| BUGFIX.md | é‡å¯é—®é¢˜ä¿®å¤ | å¼€å‘è€… |
| QUICKFIX.md | å¿«é€Ÿå‚è€ƒ | æ•…éšœæ’é™¤ |
| SWITCH_EXPLAINED.md | switch.py è¯¦è§£ | å­¦ä¹ è€… |
| FP_SYNO_ANALYSIS.md | åè®®åˆ†æ | å¼€å‘è€… |
| FEATURES_ENHANCED.md | åŠŸèƒ½è¯´æ˜ | é«˜çº§ç”¨æˆ· |
| EXAMPLES.md | å®Œæ•´ç¤ºä¾‹ | æ‰€æœ‰ç”¨æˆ· |
| SUMMARY.md | æ€»ç»“æ–‡æ¡£ | æ‰€æœ‰ç”¨æˆ· |

## ğŸ”„ å¼€å‘å†ç¨‹

### ç¬¬1é˜¶æ®µ: åŸºç¡€å®ç°
- âœ… ç§»æ¤ ZW101.ino æ ¸å¿ƒåŠŸèƒ½
- âœ… åˆ›å»º Custom Component (ååºŸå¼ƒ)

### ç¬¬2é˜¶æ®µ: é‡æ„å‡çº§
- âœ… è¿ç§»åˆ° External Component
- âœ… Python é…ç½®éªŒè¯å±‚
- âœ… æ¨¡å—åŒ– Platform æ–‡ä»¶

### ç¬¬3é˜¶æ®µ: é—®é¢˜ä¿®å¤
- âœ… è¯Šæ–­é‡å¯é—®é¢˜ (çœ‹é—¨ç‹—è¶…æ—¶)
- âœ… é‡æ„ä¸ºéé˜»å¡çŠ¶æ€æœº
- âœ… ä¼˜åŒ– loop() æ€§èƒ½

### ç¬¬4é˜¶æ®µ: åŠŸèƒ½å¢å¼º
- âœ… åˆ†æ fp_syno_protocol.c
- âœ… æ·»åŠ  7 ä¸ªæ–°åŠŸèƒ½
- âœ… å®Œå–„æ–‡æ¡£ç³»ç»Ÿ

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### 1. æ™ºèƒ½é—¨ç¦
- æŒ‡çº¹å¼€é”
- ç”¨æˆ·ç®¡ç†
- è®¿é—®æ—¥å¿—

### 2. è€ƒå‹¤ç³»ç»Ÿ
- å‘˜å·¥æ‰“å¡
- è®¿å®¢ç™»è®°
- ç»Ÿè®¡åˆ†æ

### 3. å®‰å…¨ä¿é™©ç®±
- æŒ‡çº¹è§£é”
- å¤šç”¨æˆ·æƒé™
- LED æç¤º

### 4. æ™ºèƒ½å®¶å±…
- åœºæ™¯è”åŠ¨
- ä¸ªæ€§åŒ–è®¾ç½®
- è¯­éŸ³æç¤º

## ğŸš§ æœªæ¥æ‰©å±•

### ä¼˜å…ˆçº§ 1
- [ ] å†™ç³»ç»Ÿå‚æ•° (0x0E) - é…ç½®å®‰å…¨ç­‰çº§
- [ ] è¯»ç´¢å¼•è¡¨ (0x1F) - è·å–æ‰€æœ‰ ID
- [ ] é”™è¯¯ç å®Œå–„ - 40+ é”™è¯¯ç±»å‹

### ä¼˜å…ˆçº§ 2
- [ ] Template å¯¼å‡º/å¯¼å…¥ - å¤‡ä»½æ¢å¤
- [ ] è‡ªå­¦ä¹ åŠŸèƒ½æ§åˆ¶ - æé«˜å‡†ç¡®ç‡
- [ ] ç»Ÿè®¡ä¿¡æ¯ - åŒ¹é…æ¬¡æ•°ã€æˆåŠŸç‡

### ä¼˜å…ˆçº§ 3
- [ ] Web ç®¡ç†ç•Œé¢
- [ ] å¤šè¯­è¨€æ”¯æŒ
- [ ] äº‘ç«¯åŒæ­¥

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. ç¡¬ä»¶è¿æ¥
- âš ï¸ ZW101 VCC å¿…é¡»ç‹¬ç«‹ 5V ä¾›ç”µ
- âœ… TX/RX äº¤å‰è¿æ¥
- âœ… æ³¢ç‰¹ç‡ 57600

### 2. é…ç½®å»ºè®®
- æ¯ç§’æœç´¢ä¸€æ¬¡ (å¯è°ƒæ•´)
- æ³¨å†Œé‡‡é›† 5 æ¬¡
- æœ€å¤§é‡è¯• 5 æ¬¡

### 3. LED ä½¿ç”¨
- å¾…æœº: è“è‰²å‘¼å¸ (çœç”µ)
- æˆåŠŸ: ç»¿è‰²å¸¸äº® 3ç§’
- å¤±è´¥: çº¢è‰²é—ªçƒ 3æ¬¡

### 4. èŠ‚èƒ½æ¨¡å¼
- å¤œé—´è‡ªåŠ¨ä¼‘çœ 
- æ—©æ™¨è‡ªåŠ¨å”¤é†’
- è¶…æ—¶åä¼‘çœ 

## âœ… æ€»ç»“

æœ¬é¡¹ç›®æˆåŠŸå°† ZW101 æŒ‡çº¹æ¨¡ç»„é›†æˆåˆ° ESPHome,å®ç°äº†:

1. **åŠŸèƒ½å®Œæ•´** - 17+ å‘½ä»¤æ”¯æŒ
2. **æ¶æ„å…ˆè¿›** - External Component æ ‡å‡†
3. **æ€§èƒ½ä¼˜ç§€** - éé˜»å¡çŠ¶æ€æœº
4. **æ–‡æ¡£å®Œå–„** - 8 ä»½è¯¦ç»†æ–‡æ¡£
5. **æ˜“äºä½¿ç”¨** - çº¯ YAML é…ç½®

é€‚åˆæ‰€æœ‰éœ€è¦æŒ‡çº¹è¯†åˆ«åŠŸèƒ½çš„ ESPHome é¡¹ç›®! ğŸ‰

---

**ç‰ˆæœ¬**: 1.0.0
**æ—¥æœŸ**: 2025-10-20
**ä½œè€…**: Based on ZW101.ino and fp_syno_protocol.c
**è®¸å¯**: MIT License
